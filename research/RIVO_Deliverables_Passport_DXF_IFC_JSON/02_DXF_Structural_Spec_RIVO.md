# DXF-структурная спецификация для конфигуратора RIVO Fix (CAD-режим)

## 1. Единицы и система координат
- Единицы: **миллиметры**
- UCS: правая система координат
  - X — ширина (горизонталь фронтального вида)
  - Y — высота
  - Z — глубина (используется для 3D, в DXF 2D проекции — вторичная ось)

## 2. Листы/виды
В DXF формировать как минимум 2 «пространства» (или 2 набора слоёв/блоков):
- **FRONT (основной вид)** — ортогональная проекция на плоскость XY
- **SIDE (вид сбоку)** — ортогональная проекция на плоскость YZ (X заменяется на Z)

Рекомендация: размещать виды на одном листе Model Space с разнесением по X (например, SIDE сдвинут вправо на +W+Δ).

## 3. Слои (Layer Map)
Обязательные слои (именование фиксированное):
- `RIVO_PROFILE` — профили (контуры/ось)
- `RIVO_CONNECTORS` — соединители (100002, 100014, 100007, 100006 и т.п.)
- `RIVO_SUPPORTS` — опоры/крепления (100004/100005/100009/100010/100011)
- `RIVO_EQUIPMENT` — инсталляции (RIVO Set) и панели (RIVO Touch) как блоки
- `RIVO_AXES` — осевые (штрихпунктир)
- `RIVO_DIMS` — размеры
- `RIVO_TEXT` — текст/выноски
- `RIVO_HATCH` — штриховки (опционально)
- `RIVO_HIDDEN` — скрытые линии (опционально)

## 4. Типы линий (LTYPE)
- `CONTINUOUS` — профиль/видимые контуры
- `CENTER` — осевые
- `HIDDEN` — скрытые линии (если применяются)

## 5. Геометрические примитивы (Entity Rules)

### 5.1 Профили
- Для 2D-CAD: `LWPOLYLINE` (замкнутый контур с толщиной 0) или параллельные линии профиля + ось.
- У каждого профиля должен быть **handle-id** и привязка к элементу BOM (art=100001.*).

Атрибуты (через XDATA или block attributes, если профиль в BLOCK):
- `ART=100001.1` (или 100098, если нужна упаковочная логика в BOM)
- `LEN=<mm>`
- `ROLE=STUD|BEAM|BRACE`
- `VIEW=FRONT|SIDE`

### 5.2 Соединители и крепёж
- Рекомендуемый способ: `BLOCK` + `INSERT`
- Имя блока: `RIVO_<ART>` (пример: `RIVO_100002`, `RIVO_100014`)
- Геометрия внутри блока: упрощённый контур + посадочные точки (snap points)

Атрибуты блока:
- `ART`
- `QTY`
- `NOTE` (опц.)

### 5.3 Оси
- `LINE` или `LWPOLYLINE` на слое `RIVO_AXES` с linetype `CENTER`
- По стойкам: ось в середине профиля
- По перемычкам: аналогично

### 5.4 Размеры
Использовать:
- `DIMLINEAR` для вертикали/горизонтали
- `DIMALIGNED` для межосевых/наклонных

Правила размеров:
- Не дублировать размеры
- Главные: W, H (FRONT), D (SIDE)
- Межосевые: шаг стоек, высоты выводов, отметка 0.000

### 5.5 Тексты и выноски
- `MTEXT` (предпочтительно) на слое `RIVO_TEXT`
- Формат:
  - Артикул
  - Позиция BOM
  - Примечание/узел

## 6. Библиотека блоков (обязательный минимум)
Должны существовать блоки:
- `RIVO_100001` (если профили решено хранить блоком)
- `RIVO_100002`
- `RIVO_100014`
- `RIVO_100007`
- `RIVO_100004`
- `RIVO_100005`
- `RIVO_100006`
- `RIVO_100008`
- `RIVO_100009`
- `RIVO_100010`
- `RIVO_100011`
- `RIVO_100003`
- `RIVO_100012`
- `RIVO_100013`
- `RIVO_200001`, `RIVO_200002`, `RIVO_203001`, `RIVO_201001` (габаритные блоки)
- `RIVO_TOUCH_301xxx/302xxx/303xxx` (габаритные блоки панелей)

Примечание: точная геометрия профиля/узлов в DXF должна подгружаться из «библиотеки сэмплов» (DXF/JSON) от производителя; если геометрии нет — допускается условное изображение (symbolic CAD).

## 7. Соответствие DXF ↔ BOM
Каждый `INSERT` и/или профиль-объект обязан иметь:
- `ART`
- `QTY` (для INSERT) или `LEN` (для профиля)
- `POS` (позиция спецификации)

## 8. Точность
- Округление координат: 0.1 мм (внутри движка можно 0.01 мм)
- Размеры выводить в мм, без десятичных при целых значениях

## 9. Тесты DXF (критерии приемки)
- Открывается в AutoCAD/BricsCAD без ошибок
- Все слои присутствуют
- Блоки вставляются корректно
- Размеры не пересекаются с геометрией
- FRONT является основным и расположен слева
