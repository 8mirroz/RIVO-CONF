openapi: 3.1.0
info:
  title: RIVO Configurator API
  version: "1.0.0"
  description: "End-to-end API for RIVO Configurator, validating states, calculating CPQ, and generating DXF/IFC/Passport exports."

servers:
  - url: /api/v1
    description: Core API v1

paths:
  /solutions/generate:
    post:
      summary: "Generate a configuration solution."
      operationId: generateSolution
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigurationSnapshot'
      responses:
        "200":
          description: "Returns the configuration snapshot."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigurationSnapshot'
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorEnvelope'

  /configurations/validate:
    post:
      summary: "Validate a given configuration state."
      operationId: validateConfiguration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigurationSnapshot'
      responses:
        "200":
          description: "Returns validation results."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ValidationResultItem'
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorEnvelope'

  /cpq/calculate:
    post:
      summary: "Calculate Prices and BOM."
      operationId: calculateCpq
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigurationSnapshot'
      responses:
        "200":
          description: "Returns complete CPQ Quote including BOM."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PriceQuote'
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorEnvelope'

  /exports/pdf:
    post:
      summary: "Export Technical Passport PDF."
      operationId: exportPdf
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RivoExportConfig'
      responses:
        "200":
          description: "Returns PDF binary standard."
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorEnvelope'

  /exports/dxf:
    post:
      summary: "Export DXF Drawing."
      operationId: exportDxf
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RivoExportConfig'
      responses:
        "200":
          description: "Returns DXF binary stream."
          content:
            application/dxf:
              schema:
                type: string
                format: binary
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorEnvelope'

  /exports/ifc:
    post:
      summary: "Export IFC4 BIM Model."
      operationId: exportIfc
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RivoExportConfig'
      responses:
        "200":
          description: "Returns IFC STEP format stream."
          content:
            application/step:
              schema:
                type: string
                format: binary
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorEnvelope'

  /exports/rivo:
    post:
      summary: "Generate canonical .rivo.json from ConfigurationSnapshot."
      operationId: exportRivo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigurationSnapshot'
      responses:
        "200":
          description: "Returns canonical RivoExportConfig JSON."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RivoExportConfig'
        "400":
          description: "Bad Request"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorEnvelope'

components:
  schemas:
    ConfigurationSnapshot:
      $ref: './schemas/configuration-snapshot.schema.json'
    ValidationResultItem:
      $ref: './schemas/validation-result-item.schema.json'
    BomItem:
      $ref: './schemas/bom-item.schema.json'
    PriceQuote:
      $ref: './schemas/price-quote.schema.json'
    StructureGraph:
      $ref: './schemas/structure-graph.schema.json'
    ErrorEnvelope:
      $ref: './schemas/error-envelope.schema.json'
    RivoExportConfig:
      $ref: './schemas/rivo-config.schema.json'
